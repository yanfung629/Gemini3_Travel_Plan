To combine the provided HTML code for the Kyushu trip with the Firebase budget tracking functionality we discussed earlier, I'll integrate the two pieces of code. This combined version will create a cohesive web application that retains the trip itinerary features while also incorporating the budget tracking feature.

### Combined `index.html` Code

```html
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>九州慢旅 27/2 - 5/3 | Kyushu Trip</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500&family=Noto+Serif+TC:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'paper': '#F9F9F7',
                        'ink': '#2D2D2D',
                        'gold': '#C5A065',
                        'sub': '#8E8E93',
                    },
                    fontFamily: {
                        sans: ['"Noto Sans TC"', 'sans-serif'],
                        serif: ['"Noto Serif TC"', 'serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #F9F9F7; -webkit-tap-highlight-color: transparent; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .glass-panel { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.5); }
        [x-cloak] { display: none !important; }
    </style>
</head>
<body class="text-ink h-screen flex flex-col font-sans" x-data="tripApp()">
    <!-- Top Navigation -->
    <header class="fixed top-0 w-full z-30 transition-all duration-300" 
            :class="scrolled ? 'bg-paper/95 backdrop-blur shadow-sm pt-safe' : 'bg-transparent pt-safe text-white'">
        <div class="flex justify-between items-center px-5 py-4">
            <div>
                <h1 class="text-lg font-serif font-bold tracking-wide" :class="scrolled ? 'text-ink' : 'text-white drop-shadow-md'">九州慢旅</h1>
            </div>
            <div class="text-xs font-bold px-3 py-1 rounded-full border backdrop-blur-md" 
                 :class="scrolled ? 'border-stone-300 text-stone-600' : 'border-white/30 text-white bg-black/20'">
                7 Days
            </div>
        </div>
        
        <!-- Date Slider -->
        <div class="overflow-hidden transition-all duration-300" :style="scrolled ? 'max-height: 80px; opacity: 1;' : 'max-height: 0; opacity: 0;'">
            <div class="flex overflow-x-auto hide-scrollbar px-4 pb-2 space-x-4">
                <template x-for="(day, index) in itinerary" :key="index">
                    <button @click="scrollToDay(index)" 
                            class="flex flex-col items-center min-w-[50px] space-y-1 transition-all duration-300"
                            :class="activeDayIndex === index ? 'opacity-100 scale-110' : 'opacity-40 scale-90'">
                        <span class="text-[10px] font-bold tracking-widest uppercase text-sub" x-text="day.weekday_en"></span>
                        <span class="text-lg font-serif font-bold text-ink" x-text="day.day"></span>
                        <div class="w-1 h-1 rounded-full bg-gold" x-show="activeDayIndex === index"></div>
                    </button>
                </template>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto px-0 hide-scrollbar scroll-smooth bg-paper" id="mainContainer" @scroll="handleScroll">
        
        <!-- Tab: 行程 (Itinerary) -->
        <div x-show="activeTab === 'itinerary'">
            <div class="space-y-12 pb-28 pt-24 relative z-10 px-4">
                <template x-for="(day, dIndex) in itinerary" :key="dIndex">
                    <div :id="'day-' + dIndex" class="relative pt-6">
                        <div class="mb-4 flex items-end justify-between px-2">
                            <div>
                                <h2 class="text-5xl font-serif font-bold text-stone-200 relative z-0 -mb-9 -ml-1 select-none" x-text="'0' + (dIndex + 1)"></h2>
                                <div class="relative z-10 pl-2">
                                    <span class="block text-xs font-bold tracking-widest text-gold mb-0.5" x-text="day.date_full"></span>
                                    <span class="text-2xl font-serif font-bold text-ink" x-text="day.location"></span>
                                </div>
                            </div>
                            <!-- Weather -->
                            <div class="flex flex-col items-end">
                                <i class="text-xl text-stone-400 mb-1" :class="day.weatherIcon"></i>
                                <div class="text-xs text-sub font-mono">11° / 18°</div>
                            </div>
                        </div>

                        <!-- Events -->
                        <div class="space-y-6">
                            <template x-for="(event, eIndex) in day.events" :key="eIndex">
                                <div @click="openModal(event)" class="group relative bg-white rounded-2xl overflow-hidden shadow-[0_4px_20px_rgba(0,0,0,0.03)] transition-transform active:scale-[0.98] border border-stone-100 cursor-pointer">
                                    
                                    <!-- Image -->
                                    <div class="relative h-48 w-full overflow-hidden">
                                        <img :src="event.image" class="w-full h-full object-cover transition duration-700 group-hover:scale-105">
                                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent"></div>
                                        
                                        <!-- Upload Button -->
                                        <div class="absolute top-3 right-3 z-20" @click.stop>
                                            <label class="bg-black/30 backdrop-blur text-white text-[10px] px-2 py-1 rounded-full cursor-pointer hover:bg-black/50 transition flex items-center">
                                                <i class="fas fa-camera mr-1"></i>更換
                                                <input type="file" class="hidden" accept="image/*" @change="uploadImage($event, dIndex, eIndex)">
                                            </label>
                                        </div>
                                        <div class="absolute bottom-3 left-4 text-white">
                                            <div class="flex items-center space-x-2 mb-1">
                                                <span class="bg-white/20 backdrop-blur px-2 py-0.5 rounded text-[10px] font-mono tracking-wider" x-text="event.time"></span>
                                                <span class="text-[10px] uppercase tracking-widest opacity-90 border border-white/30 px-1.5 rounded" x-text="event.category"></span>
                                            </div>
                                            <h3 class="text-lg font-serif font-bold tracking-wide shadow-black drop-shadow-md" x-text="event.title"></h3>
                                        </div>
                                    </div>
                                    <!-- Details -->
                                    <div class="p-4 flex justify-between items-center bg-white">
                                        <p class="text-sm text-stone-500 line-clamp-1" x-text="event.desc"></p>
                                        <i class="fas fa-chevron-right text-stone-300 text-xs"></i>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- Tab: 鐵道時刻 -->
        <div x-show="activeTab === 'trains'" class="px-4 space-y-6 pt-24 pb-28">
            <div class="text-center mb-8">
                <h2 class="text-2xl font-serif font-bold text-ink">鐵道時刻表</h2>
                <div class="w-10 h-1 bg-gold mx-auto mt-2 mb-1"></div>
                <p class="text-[10px] text-sub tracking-widest uppercase">LONG DISTANCE TRAINS</p>
            </div>
            <template x-for="train in trainSchedule">
                <div class="bg-white rounded-xl overflow-hidden shadow-sm border border-stone-200">
                    <div class="bg-stone-50 px-4 py-2 border-b border-stone-100 flex justify-between items-center">
                        <span class="font-bold text-xs text-stone-500" x-text="train.date"></span>
                        <span class="text-[10px] px-2 py-1 bg-indigo-50 text-indigo-600 rounded font-bold border border-indigo-100" x-text="train.name"></span>
                    </div>
                    <div class="p-4 flex items-center justify-between relative">
                        <div class="text-center w-1/3">
                            <div class="text-xl font-bold font-mono text-ink" x-text="train.depTime"></div>
                            <div class="text-xs text-sub mt-1" x-text="train.depStn"></div>
                        </div>
                        <div class="flex-1 flex flex-col items-center px-2">
                            <div class="text-[10px] text-stone-400 mb-1" x-text="train.duration"></div>
                            <div class="w-full h-[1px] bg-stone-300 relative">
                                <div class="absolute right-0 top-1/2 -translate-y-1/2 w-1 h-1 bg-stone-300 rounded-full"></div>
                                <i class="fas fa-train absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 text-stone-400 bg-white px-1 text-xs"></i>
                            </div>
                        </div>
                        <div class="text-center w-1/3">
                            <div class="text-xl font-bold font-mono text-ink" x-text="train.arrTime"></div>
                            <div class="text-xs text-sub mt-1" x-text="train.arrStn"></div>
                        </div>
                    </div>
                </div>
            </template>
        </div>

        <!-- Tab: 準備 -->
        <div x-show="activeTab === 'prep'" class="px-4 space-y-6 pt-24 pb-28">
            <h2 class="text-2xl font-serif font-bold text-ink mb-4">行前準備</h2>
            <!-- Visit Japan Web -->
            <div class="bg-gradient-to-br from-rose-500 to-pink-600 rounded-2xl p-6 text-white shadow-lg relative overflow-hidden group">
                <div class="relative z-10">
                    <h3 class="font-bold text-xl mb-1">Visit Japan Web</h3>
                    <p class="text-xs opacity-90 mb-4 font-light">入境審查、海關申報 QR Code 必備</p>
                    <a href="https://vjw-lp.digital.go.jp/en/" target="_blank" class="inline-flex items-center bg-white text-pink-600 text-xs font-bold px-4 py-2 rounded-full shadow-sm hover:bg-stone-100 transition">
                        前往填寫 <i class="fas fa-arrow-right ml-2"></i>
                    </a>
                </div>
                <i class="fas fa-qrcode absolute -right-6 -bottom-6 text-[140px] opacity-20 rotate-12 group-hover:rotate-0 transition duration-500"></i>
            </div>
            <!-- 預算概覽 + 新增項目 -->
            <div class="bg-white rounded-xl p-5 border border-stone-200 shadow-sm">
                <h3 class="font-serif font-bold text-lg mb-4 flex items-center">
                    <i class="fas fa-wallet text-gold mr-2"></i>預算概覽
                </h3>
                <!-- 新增項目表單 -->
                <div class="mb-4 border border-stone-100 rounded-lg p-3 bg-paper/60">
                    <p class="text-[11px] text-sub mb-2">新增預算項目</p>
                    <div class="flex gap-2 mb-2">
                        <input
                            type="text"
                            placeholder="項目名稱（例如：拉麵、購物）"
                            class="flex-1 border border-stone-300 rounded-lg px-2.5 py-1.5 text-xs focus:outline-none focus:ring-1 focus:ring-gold"
                            x-model="newBudgetName"
                        >
                        <input
                            type="number"
                            min="0"
                            placeholder="金額 (¥)"
                            class="w-28 border border-stone-300 rounded-lg px-2.5 py-1.5 text-xs text-right focus:outline-none focus:ring-1 focus:ring-gold"
                            x-model.number="newBudgetPrice"
                        >
                    </div>
                    <button
                        @click="addBudgetItem()"
                        class="w-full bg-ink text-white text-xs font-bold py-2 rounded-lg hover:bg-black transition disabled:opacity-40"
                        :disabled="!newBudgetName || !newBudgetPrice"
                    >
                        <i class="fas fa-plus mr-1"></i>加入預算清單
                    </button>
                </div>
                <!-- 預算列表 -->
                <div class="space-y-3">
                    <template x-for="(item, idx) in budgetItems" :key="idx">
                        <div class="flex justify-between items-center text-sm border-b border-stone-50 pb-2 last:border-0">
                            <div>
                                <span class="text-stone-600" x-text="item.name"></span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="font-mono font-medium" x-text="'¥' + item.price.toLocaleString()"></span>
                                <button
                                    class="text-[11px] text-sub hover:text-rose-500"
                                    @click="removeBudgetItem(idx)"
                                >
                                    刪除
                                </button>
                            </div>
                        </div>
                    </template>
                    <!-- Total -->
                    <div class="flex justify-between text-xl font-bold pt-3 text-ink border-t border-stone-200 mt-2">
                        <span>Total</span>
                        <span x-text="'¥' + totalBudget.toLocaleString()"></span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Detail Modal -->
    <div x-show="modalOpen" class="fixed inset-0 z-50 flex items-end sm:items-center justify-center pointer-events-none" x-cloak>
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm pointer-events-auto transition-opacity duration-300" 
             x-show="modalOpen" x-transition.opacity @click="modalOpen = false"></div>
        
        <div class="bg-paper w-full max-w-md h-[85vh] sm:h-auto sm:rounded-2xl rounded-t-3xl shadow-2xl overflow-y-auto pointer-events-auto transform transition-transform duration-300 flex flex-col"
             x-show="modalOpen" 
             x-transition:enter="translate-y-full" x-transition:enter-end="translate-y-0"
             x-transition:leave="translate-y-0" x-transition:leave-end="translate-y-full">
            
            <button @click="modalOpen = false" class="absolute top-4 right-4 z-20 w-8 h-8 bg-black/20 backdrop-blur text-white rounded-full flex items-center justify-center hover:bg-black/40 transition">
                <i class="fas fa-times"></i>
            </button>
            <div class="h-64 shrink-0 relative">
                <img :src="selectedEvent?.image" class="w-full h-full object-cover">
                <div class="absolute inset-0 bg-gradient-to-t from-paper to-transparent"></div>
            </div>
            <div class="px-6 pb-8 -mt-12 relative z-10 flex-1">
                <div class="mb-6">
                    <div class="flex items-center space-x-2 mb-2">
                        <span class="text-[10px] font-bold text-white bg-gold px-2 py-0.5 rounded tracking-widest uppercase" x-text="selectedEvent?.category"></span>
                        <span class="text-xs text-sub font-mono" x-text="selectedEvent?.time"></span>
                    </div>
                    <h2 class="text-3xl font-serif font-bold text-ink leading-tight mb-2" x-text="selectedEvent?.title"></h2>
                    <p class="text-sm text-sub" x-text="selectedEvent?.location_detail"></p>
                </div>
                <div class="prose prose-stone prose-sm mb-8 text-stone-600 leading-relaxed" x-html="selectedEvent?.desc"></div>
                <div class="bg-white rounded-xl p-5 shadow-sm border border-stone-100 mb-6" x-show="selectedEvent?.japanese && selectedEvent?.japanese.length > 0">
                    <h4 class="text-[10px] font-bold text-stone-400 uppercase mb-3 tracking-widest border-b border-stone-100 pb-2">指差會話 Point &amp; Speak</h4>
                    <div class="space-y-4">
                        <template x-for="phrase in selectedEvent?.japanese">
                            <div>
                                <p class="text-lg font-bold text-ink mb-0.5" x-text="phrase.jp"></p>
                                <p class="text-xs text-sub" x-text="phrase.zh"></p>
                            </div>
                        </template>
                    </div>
                </div>
                <div class="grid grid-cols
