<!DOCTYPE html>
<html lang="zh-Hant" x-data="tripApp()">
<head>
  <meta charset="UTF-8" />
  <title>九州旅行 | 行程</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Alpine -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
  <!-- Font / Icon -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    body {
      font-family: 'Noto Sans TC', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background-color: #F7F3EE;
      -webkit-tap-highlight-color: transparent;
    }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    .nav-active { color: #111827; font-weight: 600; }
    .nav-inactive { color: #9CA3AF; }
  </style>
</head>

<body class="min-h-screen flex flex-col bg-[#F7F3EE] text-stone-800">

  <!-- 整個 App 容器 -->
  <div class="flex-1 flex flex-col max-w-md mx-auto w-full relative">

    <!-- ====== 頂部 Header + 日期時間軸 ====== -->
    <header class="pt-6 pb-3 px-4 bg-[#F7F3EE] sticky top-0 z-20">
      <div class="flex items-start justify-between mb-4">
        <div>
          <div class="text-[11px] tracking-[0.2em] text-stone-400 uppercase mb-1">FAMILY TRIP</div>
          <div class="flex items-center gap-2">
            <h1 class="text-xl font-semibold tracking-wide">九州旅行</h1>
            <span class="text-xs text-stone-400 border border-stone-300 rounded-full px-2 py-0.5">2026</span>
          </div>
        </div>
        <button class="w-8 h-8 flex items-center justify-center rounded-full border border-stone-300 text-stone-400 text-xs">
          ×
        </button>
      </div>

      <!-- 日期時間軸 -->
      <div class="flex items-center gap-3 overflow-x-auto no-scrollbar border-t border-b border-stone-200 py-2">
        <template x-for="(day, index) in days" :key="index">
          <button
            class="flex flex-col items-center min-w-[44px] px-1 py-1 rounded-full transition"
            :class="currentDayIndex === index ? 'bg-white shadow-sm' : 'bg-transparent'"
            @click="selectDay(index)"
          >
            <span class="text-[10px] uppercase tracking-wide"
                  :class="currentDayIndex === index ? 'text-stone-700' : 'text-stone-400'">
              <span x-text="day.weekdayEn"></span>
            </span>
            <span class="text-sm font-semibold"
                  :class="currentDayIndex === index ? 'text-stone-900' : 'text-stone-500'">
              <span x-text="day.date"></span>
            </span>
            <!-- 紅點 -->
            <span class="mt-1 w-1 h-1 rounded-full"
                  :class="currentDayIndex === index ? 'bg-red-500' : 'bg-transparent'"></span>
          </button>
        </template>
      </div>
    </header>

    <!-- ====== 主內容：行程 / 火車時間表 ====== -->
    <main class="flex-1 overflow-y-auto no-scrollbar px-4 pb-28">

      <!-- Tab 切換（行程 / 火車） -->
      <div class="flex justify-center gap-6 text-xs mt-4 mb-3">
        <button
          class="pb-1 border-b-2"
          :class="activePage === 'itinerary' ? 'border-stone-900 text-stone-900' : 'border-transparent text-stone-400'"
          @click="activePage = 'itinerary'">
          行程
        </button>
        <button
          class="pb-1 border-b-2"
          :class="activePage === 'trains' ? 'border-stone-900 text-stone-900' : 'border-transparent text-stone-400'"
          @click="activePage = 'trains'">
          火車時間表
        </button>
      </div>

      <!-- =========== 行程主頁 =========== -->
      <section x-show="activePage === 'itinerary'" x-transition>
        <!-- 當日標題 -->
        <div class="flex items-center justify-between mb-2">
          <div class="flex items-center gap-2">
            <div class="text-sm text-stone-500">
              <span class="mr-1" x-text="`第 ${days[currentDayIndex].dayNo} 天`"></span>
              <span class="text-xs align-middle" x-text="days[currentDayIndex].weekdayZh"></span>
            </div>
          </div>
          <div class="text-[11px] text-stone-400">
            <span x-text="days[currentDayIndex].city"></span>
          </div>
        </div>

        <!-- 大圖卡：今日 highlight + 圖片 upload -->
        <div class="bg-white rounded-2xl overflow-hidden shadow-sm mb-4 border border-stone-200">
          <div class="relative">
            <!-- 已經有圖就顯示圖；冇就顯示 placeholder -->
            <template x-if="days[currentDayIndex].coverImage">
              <img :src="days[currentDayIndex].coverImage"
                   class="w-full h-44 object-cover" alt="cover">
            </template>
            <template x-if="!days[currentDayIndex].coverImage">
              <div class="w-full h-44 bg-stone-200 flex flex-col items-center justify-center text-stone-500 text-xs">
                <i class="fa-regular fa-image text-2xl mb-1"></i>
                尚未上載今日封面照片
              </div>
            </template>

            <!-- 圖片 Upload 按鈕 -->
            <button
              class="absolute right-3 top-3 bg-white/90 border border-stone-200 text-[11px] px-2 py-1 rounded-full flex items-center gap-1 shadow-sm"
              @click="$refs.coverInput.click()">
              <i class="fa-solid fa-camera text-[11px]"></i>
              上載圖片
            </button>
            <input
              type="file"
              accept="image/*"
              class="hidden"
              x-ref="coverInput"
              @change="onCoverUpload($event)"
            >

            <!-- 圖上文字 -->
            <div class="absolute left-4 bottom-4 text-white drop-shadow-md">
              <div class="text-[11px] mb-1 tracking-[0.18em]" x-text="days[currentDayIndex].label"></div>
              <div class="text-lg font-semibold" x-text="days[currentDayIndex].highlight"></div>
            </div>
          </div>
        </div>

        <!-- 天氣 -->
        <section class="mb-4">
          <div class="flex items-center justify-between mb-1">
            <div class="text-sm">
              <span x-text="days[currentDayIndex].city"></span>
            </div>
            <div class="text-[10px] text-stone-400">
              未來 24 小時預報 · Open‑Meteo（示意）
            </div>
          </div>

          <div class="bg-[#F9F5F0] rounded-2xl border border-stone-200 px-3 py-2">
            <div class="flex justify-between text-[10px] text-stone-400 mb-1">
              <span>現在</span>
              <template x-for="(w, idx) in weather[currentDayIndex]" :key="idx">
                <span x-text="w.hour"></span>
              </template>
            </div>
            <div class="flex justify-between items-center text-xs">
              <span class="flex items-center gap-1">
                <i class="fa-regular fa-cloud"></i>
                <span x-text="weather[currentDayIndex],[object Object],temp + '°'"></span>
              </span>
              <template x-for="(w, idx) in weather[currentDayIndex]" :key="idx">
                <div class="flex flex-col items-center text-[11px] text-stone-500">
                  <i :class="w.icon"></i>
                  <span x-text="w.temp + '°'"></span>
                </div>
              </template>
            </div>
          </div>
        </section>

        <!-- 今日行程摘要卡 -->
        <section class="mb-4">
          <div class="bg-white rounded-2xl border border-stone-200 px-4 py-3">
            <div class="flex items-center justify-between mb-2">
              <div class="text-xs tracking-[0.25em] text-stone-400">TODAY</div>
              <div class="text-[11px] text-stone-400" x-text="days[currentDayIndex].summaryLabel"></div>
            </div>

            <div class="space-y-3 text-sm">
              <template x-for="(item, idx) in days[currentDayIndex].events" :key="idx">
                <button
                  class="w-full text-left border-t border-stone-100 pt-2 first:border-0 first:pt-0"
                  @click="openEventModal(item)"
                >
                  <div class="flex justify-between items-center">
                    <div class="text-[13px] text-stone-500">
                      <span class="mr-2 font-mono" x-text="item.time"></span>
                      <span class="font-medium" x-text="item.title"></span>
                    </div>
                    <span class="text-[11px] text-stone-400" x-text="item.typeLabel"></span>
                  </div>
                  <p class="text-[11px] text-stone-400 mt-1 line-clamp-2" x-text="item.brief"></p>
                </button>
              </template>
            </div>
          </div>
        </section>

        <!-- 下方「播放列」風格：下一個行程 -->
        <section class="fixed bottom-3 left-0 right-0">
          <div class="max-w-md mx-auto px-4">
            <template x-if="nextEvent">
              <div class="bg-white border border-stone-200 rounded-2xl shadow-sm px-3 py-2 flex items-center gap-3">
                <div class="flex-1">
                  <div class="flex items-center gap-2 text-xs text-stone-400 mb-0.5">
                    <i class="fa-regular fa-clock text-[11px]"></i>
                    <span>下一個行程</span>
                  </div>
                  <div class="flex items-baseline gap-2">
                    <span class="text-base font-semibold font-mono" x-text="nextEvent.time"></span>
                    <span class="text-[13px]" x-text="nextEvent.title"></span>
                    <span class="ml-1 text-[10px] px-1.5 py-0.5 rounded-full border border-stone-300 text-stone-500">
                      行程預覽
                    </span>
                  </div>
                </div>
                <div class="text-right text-[11px] text-stone-400">
                  <div>預計</div>
                  <div x-text="nextEvent.endTime || '--:--'"></div>
                </div>
              </div>
            </template>
          </div>
        </section>
      </section>

      <!-- =========== 火車時間表 Page =========== -->
      <section x-show="activePage === 'trains'" x-transition>
        <h2 class="text-sm tracking-[0.25em] text-stone-500 mt-2 mb-3">
          火車時間表（30 分鐘以上）
        </h2>

        <!-- 篩選 / 排序（示意，可按需要再擴充） -->
        <div class="flex gap-2 mb-3 text-[11px]">
          <div class="flex-1">
            <label class="block text-stone-400 mb-1">列車種類</label>
            <select x-model="trainFilter.type"
                    class="w-full text-xs rounded-full border border-stone-300 bg-[#F7F3EE] px-3 py-1.5 focus:outline-none">
              <option value="">全部</option>
              <option value="shinkansen">新幹線</option>
              <option value="limited">特急</option>
              <option value="sightseeing">觀光列車</option>
            </select>
          </div>
          <div class="w-28">
            <label class="block text-stone-400 mb-1">排序</label>
            <select x-model="trainFilter.sort"
                    class="w-full text-xs rounded-full border border-stone-300 bg-[#F7F3EE] px-3 py-1.5 focus:outline-none">
              <option value="day">按日子</option>
              <option value="time">按時間</option>
              <option value="duration">按車程</option>
            </select>
          </div>
        </div>

        <!-- 列表 -->
        <div class="space-y-3 mb-10">
          <template x-for="(t, idx) in filteredTrains" :key="idx">
            <article class="bg-white rounded-2xl border border-stone-200 px-4 py-3 text-sm">
              <div class="flex items-center justify-between mb-1">
                <div class="flex items-center gap-2">
                  <span class="text-[11px] px-2 py-0.5 rounded-full border border-stone-300 text-stone-500">
                    <span x-text="t.dayLabel"></span>
                  </span>
                  <span class="font-semibold" x-text="t.name"></span>
                </div>
                <span class="text-[11px] text-stone-400" x-text="t.typeLabel"></span>
              </div>

              <div class="flex items-center justify-between mt-1 mb-1 text-[13px]">
                <div class="flex flex-col">
                  <span class="text-stone-500" x-text="t.from"></span>
                  <span class="text-[11px] text-stone-400">出發 <span x-text="t.depart"></span></span>
                </div>
                <div class="text-stone-300">
                  <i class="fa-solid fa-arrow-right-long"></i>
                </div>
                <div class="flex flex-col text-right">
                  <span class="text-stone-500" x-text="t.to"></span>
                  <span class="text-[11px] text-stone-400">到達 <span x-text="t.arrive"></span></span>
                </div>
              </div>

              <div class="flex items-center justify-between text-[11px] text-stone-400 mb-1">
                <span>車程：約 <span x-text="t.durationText"></span></span>
                <span x-text="t.note"></span>
              </div>

              <template x-if="t.description">
                <p class="mt-1 text-[11px] text-stone-500" x-text="t.description"></p>
              </template>
            </article>
          </template>

          <template x-if="filteredTrains.length === 0">
            <p class="text-xs text-stone-400 text-center mt-6">
              暫時沒有符合條件的火車（≥ 30 分鐘）。
            </p>
          </template>
        </div>
      </section>
    </main>

    <!-- ====== 行程詳情 Modal ====== -->
    <div
      class="fixed inset-0 bg-black/40 flex items-end justify-center z-30"
      x-show="showModal"
      x-transition
      @click.self="closeModal()"
    >
      <div class="bg-[#F7F3EE] w-full max-w-md rounded-t-3xl px-5 pt-4 pb-7 shadow-xl">
        <header class="flex items-start justify-between mb-3">
          <div>
            <div class="flex items-center gap-2 mb-1">
              <span class="text-[10px] px-2 py-0.5 rounded-full border border-red-300 text-red-600"
                    x-text="modalEvent.tag || 'FOOD'"></span>
              <span class="text-[11px] text-stone-400" x-text="modalEvent.time"></span>
            </div>
            <h3 class="text-base font-semibold" x-text="modalEvent.title"></h3>
          </div>
          <button class="text-stone-400 text-lg" @click="closeModal()">×</button>
        </header>

        <!-- 地址 -->
        <div class="flex items-center gap-2 text-xs text-stone-500 mb-3" x-show="modalEvent.address">
          <i class="fa-solid fa-location-dot text-[11px] text-stone-400"></i>
          <span x-text="modalEvent.address"></span>
        </div>

        <!-- 兩個主按鈕 -->
        <div class="flex flex-col gap-2 mb-4">
          <a :href="modalEvent.mapUrl" target="_blank"
             class="w-full text-center bg-emerald-600 hover:bg-emerald-700 text-white text-xs py-2.5 rounded-xl font-medium">
            <i class="fa-solid fa-location-arrow mr-1"></i> Google Maps 導航
          </a>
          <a :href="modalEvent.siteUrl" target="_blank"
             class="w-full text-center bg-black/90 hover:bg-black text-white text-xs py-2.5 rounded-xl font-medium">
            官方網站
          </a>
        </div>

        <!-- 介紹內容 -->
        <div class="space-y-2 text-[12px] text-stone-600 leading-relaxed mb-4">
          <template x-for="(p, idx) in modalEvent.paragraphs" :key="idx">
            <p x-text="p"></p>
          </template>
        </div>

        <!-- 指差し會話 -->
        <div class="mb-4" x-show="modalEvent.pointSpeak && modalEvent.pointSpeak.length">
          <div class="text-[11px] text-stone-400 mb-1">✍ 指差し會話（POINT &amp; SPEAK）</div>
          <div class="border border-stone-200 rounded-xl overflow-hidden text-[11px]">
            <template x-for="row in modalEvent.pointSpeak">
              <div class="grid grid-cols-2 border-t border-stone-200 first:border-0">
                <div class="px-3 py-1.5 bg-white" x-text="row.cn"></div>
                <div class="px-3 py-1.5 bg-stone-50" x-text="row.jp"></div>
              </div>
            </template>
          </div>
        </div>

        <!-- 電話 / GPS -->
        <div class="bg-white rounded-xl border border-stone-200 px-3 py-2 flex items-center justify-between text-[11px] text-stone-600" x-show="modalEvent.phone">
          <div class="flex items-center gap-2">
            <i class="fa-solid fa-location-arrow text-[11px] text-stone-400"></i>
            <span>CAR GPS / PHONE</span>
          </div>
          <span class="font-mono" x-text="modalEvent.phone"></span>
        </div>
      </div>
    </div>
  </div>

  <!-- Alpine Data -->
  <script>
    function tripApp() {
      return {
        activePage: 'itinerary',
        currentDayIndex: 0,
        showModal: false,
        modalEvent: {},
        trainFilter: {
          type: '',
          sort: 'day'
        },

        // 行程日資料（Demo：你可以之後自己改內容）
        days: [
          {
            dayNo: 1,
            weekdayEn: 'SAT',
            weekdayZh: '第一天',
            date: '14',
            city: '熊本市',
            label: 'DAY 1  熊本市',
            highlight: '加藤清正的熊本城',
            summaryLabel: '本日景點 / 餐食',
            coverImage: '',
            events: [
              {
                time: '13:00',
                title: '午餐：魚飯時（sahanji）',
                type: 'food',
                typeLabel: '餐食',
                brief: '時令海鮮豪華御膳 · 熊本市人氣名店',
                address: '熊本市中央區紺屋町2-14',
                mapUrl: 'https://www.google.com/maps',
                siteUrl: 'https://example.com',
                paragraphs: [
                  '油脂分佈最完美的頂級漁獲，招牌為「時令海鮮豪華御膳」。',
                  '套餐包含厚切刺身、鮮味十足的茶碗蒸，以及各式精緻小料理。'
                ],
                pointSpeak: [
                  { cn: '海鮮豪華御膳', jp: '海鮮贅沢御膳' },
                  { cn: '荒炊魚頭', jp: '荒炊き（Aradaki）' },
                  { cn: '生魚片', jp: '刺身' }
                ],
                phone: '096-356-0382',
                endTime: '13:45'
              },
              {
                time: '16:30',
                title: 'AMU Plaza 熊本 · 購物',
                type: 'sight',
                typeLabel: '自由活動',
                brief: '車站上蓋大型商場，各自覓食 / 購物。',
                endTime: '19:00'
              }
            ]
          },
          {
            dayNo: 4,
            weekdayEn: 'TUE',
            weekdayZh: '第四天',
            date: '17',
            city: '福岡（博多）',
            label: 'DAY 4  福岡（博多）',
            highlight: '豪華觀光列車',
            summaryLabel: '本日重點 · 豪華觀光列車',
            coverImage: '',
            events: [
              {
                time: '09:00',
                title: '博多站集合',
                type: 'transport',
                typeLabel: '集合',
                brief: '於博多站月台集合，準備登上觀光列車。',
                endTime: '09:30'
              },
              {
                time: '10:00',
                title: '豪華觀光列車 36+3',
                type: 'train',
                typeLabel: '觀光列車',
                brief: '沿路欣賞九州山巒與海岸風景，途中停靠玉名、牛之濱。',
                endTime: '16:30'
              },
              {
                time: '18:30',
                title: '博多晚餐 · 屋台',
                type: 'food',
                typeLabel: '晚餐',
                brief: '於中州屋台街享用拉麵或燒物，體驗夜間氛圍。',
                endTime: '20:00'
              }
            ]
          }
        ],

        // 非真實天氣，只係 Demo
        weather: [
          [
            { hour: '01:00', icon: 'fa-regular fa-sun', temp: 9 },
            { hour: '02:00', icon: 'fa-regular fa-sun', temp: 8 },
            { hour: '03:00', icon: 'fa-regular fa-sun', temp: 8 },
            { hour: '04:00', icon: 'fa-regular fa-sun', temp: 8 }
          ],
          [
            { hour: '01:00', icon: 'fa-regular fa-cloud', temp: 11 },
            { hour: '02:00', icon: 'fa-regular fa-sun', temp: 11 },
            { hour: '03:00', icon: 'fa-regular fa-sun', temp: 11 },
            { hour: '04:00', icon: 'fa-regular fa-sun', temp: 10 }
          ]
        ],

        // 火車資料（≥30 分鐘先會顯示）
        trains: [
          {
            dayIndex: 0,
            dayLabel: 'DAY 1 · 熊本',
            name: '新幹線 Tsubame',
            from: '鹿兒島中央',
            to: '熊本',
            depart: '10:00',
            arrive: '11:00',
            durationMin: 60,
            type: 'shinkansen',
            typeLabel: '新幹線',
            note: '已包含 JR Pass',
            description: '舒適自由席，沿途可欣賞九州平原景色。'
          },
          {
            dayIndex: 0,
            dayLabel: 'DAY 1 · 熊本',
            name: '特急 Kirishima',
            from: '熊本',
            to: '宮崎',
            depart: '13:00',
            arrive: '15:00',
            durationMin: 120,
            type: 'limited',
            typeLabel: '特急',
            note: '建議預約指定席',
            description: '經過霧島一帶，景色優美。'
          },
          {
            dayIndex: 1,
            dayLabel: 'DAY 4 · 福岡',
            name: '36+3 豪華列車',
            from: '博多',
            to: '鹿兒島中央',
            depart: '10:00',
            arrive: '16:30',
            durationMin: 390,
            type: 'sightseeing',
            typeLabel: '觀光列車',
            note: '需提前預約 · 餐食另計',
            description: '途中停靠玉名（足湯）、牛之濱（海景），享受慢旅時光。'
          }
        ],

        // ===== Method / 計算屬性 =====
        selectDay(index) {
          this.currentDayIndex = index;
        },

        get nextEvent() {
          const events = this.days[this.currentDayIndex].events || [];
          if (!events.length) return null;
          return events,[object Object],; // 簡單示範：預設第一個當作「下一個行程」
        },

        openEventModal(item) {
          // 若 event 自己有詳細資料就直接用；冇就簡單包裝
          this.modalEvent = Object.assign(
            {
              tag: item.type === 'food' ? 'FOOD' : 'NOTE',
              address: item.address || '',
              mapUrl: item.mapUrl || 'https://www.google.com/maps',
              siteUrl: item.siteUrl || '#',
              paragraphs: item.paragraphs || [item.brief || ''],
              pointSpeak: item.pointSpeak || [],
              phone: item.phone || ''
            },
            item
          );
          this.showModal = true;
        },

        closeModal() {
          this.showModal = false;
          this.modalEvent = {};
        },

        onCoverUpload(e) {
          const file = e.target.files,[object Object],;
          if (!file) return;
          const url = URL.createObjectURL(file);
          this.days[this.currentDayIndex].coverImage = url;
        },

        get filteredTrains() {
          // 只取 duration ≥ 30 min
          let list = this.trains.filter(t => t.durationMin >= 30);

          if (this.trainFilter.type) {
            list = list.filter(t => t.type === this.trainFilter.type);
          }

          if (this.trainFilter.sort === 'time') {
            list = list.slice().sort((a, b) => a.depart.localeCompare(b.depart));
          } else if (this.trainFilter.sort === 'duration') {
            list = list.slice().sort((a, b) => a.durationMin - b.durationMin);
          } else {
            // 按日子
            list = list.slice().sort((a, b) => a.dayIndex - b.dayIndex);
          }

          // 轉換 duration 文案
          return list.map(t => ({
            ...t,
            durationText: this.formatDuration(t.durationMin)
          }));
        },

        formatDuration(min) {
          const h = Math.floor(min / 60);
          const m = min % 60;
          if (!h) return `${m} 分鐘`;
          if (!m) return `${h} 小時`;
          return `${h} 小時 ${m} 分鐘`;
        }
      };
    }
  </script>
</body>
</html>
